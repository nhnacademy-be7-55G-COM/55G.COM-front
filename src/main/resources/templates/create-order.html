<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>주문 작성</title>
  <th:block th:replace="~{fragments/head :: headTemplate}"></th:block>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://js.tosspayments.com/v2/standard"></script>
  <style>
    #section {
      min-height: calc(100vh - 5rem);
    }
    footer {
      height: 5rem;
      border-top: 2px solid black;
    }
    #payment-background {
      position: absolute;
      display: none;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.5);
    }
    #payment-modal {
      position: absolute;
      min-width: 600px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>

<body
    style="background-color: var(--light-color); font-family: var(--body-font),serif; color: var(--body-text-color); height: 100vh">
  <div id="payment-background">
    <div id="payment-modal">
      <div id="modal-head-payment" class="d-flex flex-row">
        <div class="me-auto">토스페이먼트 결제</div>
        <button onclick="closeHandler()">[X]</button>
        <script>
          const closeHandler = () => {
            document.querySelector("#payment-background").style.display = 'none';
          }
        </script>
      </div>
<!--      토스페이먼츠 결제-->
      <div id="modal-body-payment">
        <div style="background-color: white" id="payment-method">결제중...</div>
        <div id="payment-agreement"></div>
        <button class="button" id="payment-button">결제하기</button>
        <script>
          document.querySelector("#payment-button").addEventListener('click', async () => {
            console.log("Payment!");
            axios.post('/payment/toss', {paymentKey: 'asdf'})
            .then(response => console.log(`response from controller: ${response.data}`));
          });
        </script>
      </div>
    </div>
  </div>
  <div class="container d-flex flex-column" id="section">
    <div id="order-page">
      <!-- 주문서 -->
      <h3>주문서</h3>
      <hr />
      <h4 class="mb-2">상품확인</h4>
      <table class="table mb-2">
        <thead>
        <tr>
          <th class="w-50" scope="col">상품명</th>
          <th scope="col">정가</th>
          <th scope="col">수량</th>
          <th scope="col">할인금액</th>
          <th scope="col">합계</th>
          <th scope="col">포장여부</th>
<!--            <th scope="col">배송일?</th>-->
        </tr>
        </thead>
<!--        <tbody id="shoppingCart">-->
<!--        <th:block th:each="cart: ${cartList}">-->
<!--        <tr th:data-book-id="${cart.id}">-->
<!--          <td th:text="${cart.title}"></td>-->
<!--          <td th:text="${cart.price}"></td>-->
<!--          <td th:text="${cart.quantity}"></td>-->
<!--          <td th:text="${cart.discountPrice}"></td>-->
<!--          <td th:text="${cart.totalPrice}"></td>-->
<!--          <td>-->
<!--            <div>-->
<!--              <select class="form-control-sm">-->
<!--                <option value="0" data-cost="0" selected>포장안함</option>-->
<!--                <th:block th:each="paper: ${wrappingPapaerList}">-->
<!--                <option th:value="${paper.id}" th:text="${paper.name}" th:data-cost="${paper.price}"></option>-->
<!--                </th:block>-->
<!--              </select>-->
<!--            </div>-->
<!--          </td>-->
<!--        </tr>-->
<!--        </th:block>-->
<!--        </tbody>-->
      </table>
      <h4 class="mb-2">배송주소</h4>
      <div id="receiverInfo">
        <div class="mb-2">
          <label for="inputCustomerName" class="form-label">주문인</label>
          <input id="inputCustomerName" class="form-control" type="text" name="customerName" required>
        </div>
        <div class="mb-2">
          <label for="inputReceiverName" class="form-label">받는 사람</label>
          <input id="inputReceiverName" class="form-control" type="text" name="receiverName" required>
        </div>
        <div class="mb-2">
          주소 적는 곳
        </div>
        <div>
          <label for="inputPhoneNumber" class="form-label">휴대전화번호</label>
          <input id="inputPhoneNumber" class="form-control" type="text" name="phoneNumber" required>
        </div>
      </div>
    </div>
  </div>
  <footer class="d-flex flex-row">
    <div id="description"></div>
    <div id="total-price"></div>
    <div class="d-flex">
      <button class="m-0" id="purchaseButton" onclick="paymentReady()">구매하기</button>
      <script>
        const purchaseHandler = () => {
          document.querySelector("#payment-background").style.display = 'block';
        }

      </script>
      <script th:inline="javascript">
        // paymentReady();

        async function paymentReady() {
          const clientKey = [[${clientKey}]];
          const tossPayments = TossPayments(clientKey);
          const customerKey = [[${customerKey}]];

          const payment = tossPayments.payment({ customerKey });
          await payment.requestPayment({
            method: 'CARD',
            amount: {
              currency: "KRW",
              value: 5000
            },
            orderId: [[${randomOrderId}]],
            orderName: "테스트 결제",
            successUrl: window.location.origin + "/payment/success",
            failUrl: window.location.origin + "/payment/fail",
            customerEmail: "example@example.org",
            customerName: "홍길동",
            customerMobilePhone: "01012345678",
            card: {
              useEscrow: false,
              flowMode: "DEFAULT",
              useCardPoint: false,
              useAppCardOnly: false
            }
          });
        }
      </script>
    </div>
  </footer>
</body>
</html>