<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
  <title>My Page</title>
  <meta charset="utf-8">
  <th:block th:replace="~{fragments/head :: headTemplate}"></th:block>
</head>

<body data-bs-spy="scroll" data-bs-target="#sidebar" tabindex="0">

<div th:replace="~{fragments/header}"></div>

<div class="container">
  <div class="row">
    <!-- 사이드바 -->
    <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
      <div class="position-sticky">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" id="personal-tab" data-bs-toggle="tab" href="#personal" role="tab">개인 정보</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="points-tab" data-bs-toggle="tab" href="#points" role="tab">포인트 내역</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="coupons-tab" data-bs-toggle="tab" href="#coupons" role="tab">나의 쿠폰 목록</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab">주문 목록</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab">주소 정보</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="reviews-tab" data-bs-toggle="tab" href="#reviews" role="tab">나의 리뷰 목록</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- 메인 콘텐츠 -->
    <main class="col-md-9 col-lg-10">
      <div class="tab-content" id="myTabContent">

        <!-- 개인 정보 및 계정 상태 -->
        <div class="tab-pane fade show active" id="personal" role="tabpanel">
          <h3>개인 정보</h3>
          <p>
            <a href="#" data-bs-toggle="modal" data-bs-target="#gradeInfoModal">
              <strong><span th:text="'회원 등급: '"></span></strong>
              <span th:text="'일반'"></span>
            </a>
          </p>
          <p>ID: <span th:text="test"></span></p>
          <p>연락처: <span th:text="'010-1234-5678'"></span></p>
          <p>생년월일: <span th:text="19990111"></span></p>
          <p>가입 일자: <span th:text="00"></span></p>
          <p>최근 로그인: <span th:text="00"></span></p>
          <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#updatePersonalModal">개인 정보 변경</button>
          <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#changePasswordModal">비밀번호 변경</button>
          <br>
          <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">회원 탈퇴</button>
        </div>

        <!-- 포인트 내역 -->
        <div class="tab-pane fade" id="points" role="tabpanel">
          <h3>포인트 내역</h3>
          <p>현재 포인트: <span th:text="10000"></span></p>
          <ul>
            <li th:each="point : ${pointsHistory}">
              <span th:text="${point.date}"></span> - <span th:text="${point.amount}"></span>
            </li>
          </ul>
        </div>

        <!-- 나의 쿠폰 목록 -->
        <div class="tab-pane fade" id="coupons" role="tabpanel">
          <h3>나의 쿠폰 목록</h3>
          <ul>
            <li th:each="coupon : ${coupons}">
              <span th:text="${coupon.name}"></span> - <span th:text="${coupon.discount}"></span>
            </li>
          </ul>
        </div>

        <!-- 주문 목록 -->
        <div class="tab-pane fade" id="orders" role="tabpanel">
          <h3>주문 목록</h3>
          <ul>
            <li th:each="order : ${orders}">
              <span th:text="${order.date}"></span> - <span th:text="${order.amount}"></span>
            </li>
          </ul>
        </div>

        <!-- 주소 정보 -->
        <div class="tab-pane fade" id="address" role="tabpanel">
          <h3>주소 정보</h3>
          <ul>
            <li th:each="address : ${addresses}">
              <span th:text="${address}"></span>
              <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAddressModal" data-bs-address-id="[[${address.id}]]">삭제</button>
            </li>
          </ul>

          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAddressModal">배송지 추가</button>
        </div>
        <!-- 리뷰 목록 -->
        <div class="tab-pane fade" id="reviews" role="tabpanel">
          <h3>나의 리뷰 목록</h3>
          <ul>
            <li th:each="review : ${reviewList}">
              <p><strong>상품:</strong> <span th:text="${review.productName}"></span></p>
              <p><strong>작성일:</strong> <span th:text="${review.date}"></span></p>
              <p><strong>평점:</strong> <span th:text="${review.rating}"></span> / 5</p>
              <p><strong>리뷰 내용:</strong> <span th:text="${review.content}"></span></p>
              <hr>
            </li>
          </ul>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- 개인 정보 변경 Modal -->
<div class="modal fade" id="updatePersonalModal" tabindex="-1" aria-labelledby="updatePersonalModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updatePersonalModalLabel">개인 정보 변경</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="newId" class="form-label">새 ID</label>
            <input type="text" class="form-control" id="newId" placeholder="새 ID를 입력하세요">
          </div>
          <div class="mb-3">
            <label for="phoneNumber" class="form-label">새 연락처</label>
            <input type="tel" class="form-control" id="phoneNumber" placeholder="새 연락처를 입력하세요"
                   oninput="formatPhoneNumber()">
            <div id="phoneError" style="color: red; font-size: 0.9rem; display: none;">핸드폰 번호는
              '010-0000-0000' 형식으로 입력해야 합니다
          </div>
          <div class="mb-3">
            <label for="newEmail" class="form-label">새 이메일</label>
            <input type="email" class="form-control" id="newEmail" placeholder="새 이메일을 입력하세요">
          </div>
          <button type="submit" class="btn btn-primary">변경 저장</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 회원 탈퇴 Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAccountModalLabel">회원 탈퇴</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>정말로 회원 탈퇴를 하시겠습니까?</p>
        <button class="btn btn-danger" id="confirmDeleteBtn">회원 탈퇴</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
      </div>
    </div>
  </div>
</div>
<!-- 비밀번호 변경 Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="changePasswordModalLabel">비밀번호 변경</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="changePasswordForm">
          <div class="mb-3">
            <label for="currentPassword" class="form-label">현재 비밀번호</label>
            <input type="password" class="form-control" id="currentPassword" placeholder="현재 비밀번호를 입력하세요" required>
          </div>
          <div class="mb-3">
            <label for="newPassword" class="form-label">새 비밀번호</label>
            <input type="password" class="form-control" id="newPassword" placeholder="새 비밀번호를 입력하세요" required>
          </div>
          <div class="mb-3">
            <label for="confirmNewPassword" class="form-label">새 비밀번호 확인</label>
            <input type="password" class="form-control" id="confirmNewPassword" placeholder="새 비밀번호를 다시 입력하세요" required>
          </div>
          <div id="passwordError" class="text-danger" style="display: none;">새 비밀번호와 확인 비밀번호가 일치하지 않습니다.</div>
          <button type="submit" class="btn btn-primary">비밀번호 변경</button>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- 회원 등급 정보 Modal -->
<div class="modal fade" id="gradeInfoModal" tabindex="-1" aria-labelledby="gradeInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="gradeInfoModalLabel">회원 등급 정보</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- 회원 등급에 대한 설명 -->
        <h4>회원 등급은 최근 3개월 간의 순수 주문 금액을 기준으로 합니다.</h4>
        <p><strong>일반:</strong> 0 ~ 10만 포인트 미만, 1%의 적립 혜택이 있습니다.</p>
        <p><strong>로얄:</strong> 10만 ~ 20만 포인트 미만, 2%의 적립 혜택이 있습니다.</p>
        <p><strong>골드:</strong> 20만 ~ 30만 포인트 미만, 3%의 적립 혜택이 있습니다.</p>
        <p><strong>플래티넘:</strong> 30만 ~ , 4%의 적립 혜택이 있습니다.</p>
      </div>
    </div>
  </div>
</div>
<!-- 배송지 추가 Modal -->
<div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAddressModalLabel">배송지 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="addressLine" class="form-label">배송지</label>
            <input type="text" class="form-control" id="addressLine" placeholder="배송지 정보를 입력하세요">
          </div>
          <div class="mb-3">
            <label for="addressDetails" class="form-label">상세 주소</label>
            <input type="text" class="form-control" id="addressDetails" placeholder="상세 주소를 입력하세요">
          </div>
          <button type="submit" class="btn btn-primary">배송지 추가</button>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- 배송지 삭제 Modal -->
<div class="modal fade" id="deleteAddressModal" tabindex="-1" aria-labelledby="deleteAddressModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAddressModalLabel">배송지 삭제</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>정말로 이 배송지를 삭제하시겠습니까?</p>
        <button class="btn btn-danger" id="confirmDeleteAddressBtn">삭제</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('changePasswordForm').addEventListener('submit', function(event) {
    const newPassword = document.getElementById('newPassword').value;
    const confirmNewPassword = document.getElementById('confirmNewPassword').value;
    const passwordError = document.getElementById('passwordError');

    // 검증: 새 비밀번호와 확인 비밀번호가 일치하는지 확인
    if (newPassword !== confirmNewPassword) {
      event.preventDefault(); // 폼 제출 방지
      passwordError.style.display = 'block'; // 오류 메시지 표시
    } else {
      passwordError.style.display = 'none'; // 오류 메시지 숨김
    }
  });

  function formatPhoneNumber() {
    const phoneInput = document.getElementById("phoneNumber");
    const phoneError = document.getElementById("phoneError");

    let phoneValue = phoneInput.value.replace(/[^0-9]/g, '');

    if (phoneValue.startsWith("010")) {
      if (phoneValue.length <= 3) {
        phoneInput.value = phoneValue;
      } else if (phoneValue.length <= 7) {
        phoneInput.value = `${phoneValue.slice(0, 3)}-${phoneValue.slice(3)}`;
      } else if (phoneValue.length <= 11) {
        phoneInput.value = `${phoneValue.slice(0, 3)}-${phoneValue.slice(3, 7)}-${phoneValue.slice(
            7, 11)}`;
      }
    } else {
      phoneError.style.display = "block";
      return;
    }

    phoneError.style.display = (phoneValue.length === 11) ? "none" : "block";
  }
</script>

<div th:replace="~{fragments/footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>